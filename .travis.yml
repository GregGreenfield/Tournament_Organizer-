# Travis CI build script. This gets run by github when a push is performed.
# Note you should always push to dev and then pull from master once the tests
# pass.

sudo: required

language: python

services:
    - docker

install:
    - pip install pylint

    - docker-compose build
    - cp config/dev/docker-compose.dev.yml ./docker-compose.override.yml
    - docker-compose up -d database daoserver webserver

script:

    - docker-compose -f docker-compose.yml -f config/dev/docker-compose.dev.yml run daoserver python -m unittest discover -s unit_tests --pattern=*.py


    - docker exec -it database bash -c 'psql --file=/docker-entrypoint-initdb.d/data/dev/behaviour_test_data.sql -d "$POSTGRES_DB" -U "$POSTGRES_USER" '
    - docker-compose run apitest
#    - docker-compose run systemtest


    - pylint $(find . -iname "*.py")
