database:
    image: postgres:9.3
    container_name: database
    volumes:
        - "./database/setup/:/docker-entrypoint-initdb.d"
    extends:
        file: docker-passwords.yml
        service: dbpasswords

daoserver:
    build: daoserver
    container_name: daoserver
    ports:
        - "5001:5000"
    command: bash /webapp/wait-for-postgres.sh database python -u app.py
    extends:
        file: docker-passwords.yml
        service: dbpasswords

node:
    build: node
    container_name: node
    ports:
        - "5005:8000"

# Unit Test Specific
unittestdb:
    container_name: unittestdb
    extends:
        file: docker-compose.base.yml
        service: database

unittest:
    build: daoserver
    container_name: unittest
    command: bash /webapp/wait-for-postgres.sh database python -m unittest discover -s unit_tests --pattern=*.py
    extends:
        file: docker-passwords.yml
        service: dbpasswords

# API Test Specific
apitestdb:
    container_name: apitestdb
    extends:
        file: docker-compose.base.yml
        service: database

apitestdaoserver:
    build: daoserver
    container_name: apitestdaoserver
    command: bash /webapp/wait-for-postgres.sh apitestdb python -u app.py
    ports:
        - "5002:5000"
    extends:
        file: docker-passwords.yml
        service: dbpasswords

apitest:
    build: test/dao/functionality
    container_name: dao_func

# System Test Specific
systemtestdb:
    container_name: systemtestdb
    extends:
        file: docker-compose.base.yml
        service: database

systemtestdaoserver:
    build: daoserver
    container_name: systemtestdaoserver
    command: bash /webapp/wait-for-postgres.sh systemtestdb python -u app.py
    ports:
        - "5003:5000"
    extends:
        file: docker-passwords.yml
        service: dbpasswords

systemtest_functionality:
    build: test/web/functionality
    container_name: web_functionality

systemtest_usability:
    build: test/web/usability
    container_name: web_usability

systemtestnode:
    build: node
    container_name: systemtestnode
    ports:
        - "5105:8000"

selenium:
    image: selenium/standalone-chrome
    container_name: selenium
    ports:
        - "4444:4444"
