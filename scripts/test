#! /bin/bash
pylint $(find . -iname "*.py")
eslint node test/dao/functionality
eslint node test/web/functionality

# Build all containers and run all tests
cp config/dev/docker-compose.yml docker-compose.yml
cp config/dev/docker-passwords.yml docker-passwords.yml
./scripts/install dev

docker-compose up -d unittestdb &> /dev/null
docker-compose up -d apitestdb apitestdaoserver &> /dev/null
docker-compose up -d systemtestdb systemtestdaoserver systemtestnode &> /dev/null

docker-compose run unittest

# Add some data to database for use in browser
bash scripts/insert_into_db database database/data/dev/basic_functions.sql
bash scripts/insert_into_db database database/data/dev/behaviour_test_data.sql

# API Tests
bash scripts/insert_into_db apitestdb database/data/dev/basic_functions.sql
bash scripts/insert_into_db apitestdb database/data/dev/api_test_data.sql
docker-compose run apitest

# System Tests
bash scripts/insert_into_db systemtestdb database/data/dev/basic_functions.sql
bash scripts/insert_into_db systemtestdb database/data/dev/behaviour_test_data.sql
docker-compose run systemtest_functionality
docker-compose run systemtest_usability
