#! /bin/bash

# Build all containers and run all tests
cp config/dev/docker-compose.dev.yml docker-compose.yml
cp config/dev/docker-passwords.dev.yml docker-passwords.yml
./scripts/install
docker-compose up -d apitestdb apitestdaoserver &> /dev/null

docker-compose run unittest

# API Tests
docker cp database/data/dev/behaviour_test_data.sql apitestdb:.
docker exec -it apitestdb bash -c 'psql --file=behaviour_test_data.sql -d "$POSTGRES_DB" -U "$POSTGRES_USER" '
docker-compose run apitest

# System Tests
docker cp database/data/dev/behaviour_test_data.sql database:.
docker exec -it database bash -c 'psql --file=behaviour_test_data.sql -d "$POSTGRES_DB" -U "$POSTGRES_USER" '

docker-compose run systemtest


pylint $(find . -iname "*.py")
