#! /bin/bash
./scripts/get-compose-files --dev
./scripts/clean-and-build --dev

docker-compose up -d unittestdb &> /dev/null &
docker-compose up -d apitestdb apitestdaoserver &> /dev/null &
docker-compose up -d web_func_db web_func_daoserver web_func_webserver &> /dev/null &
docker-compose up -d web_use_db web_use_daoserver web_use_webserver &> /dev/null &

wait

./scripts/lint

echo "UNITTESTS"
docker-compose run unittest

# API Tests
bash scripts/insert_into_db apitestdb database/data/dev/basic_functions.sql &> /dev/null
bash scripts/insert_into_db apitestdb database/data/dev/api_test_data.sql &> /dev/null
echo "DAO FUNCTIONALITY"
docker-compose run apitest

# Web Tests
echo "WEB FUNCTIONALITY"
bash scripts/insert_into_db web_func_db database/data/dev/basic_functions.sql &> /dev/null
bash scripts/insert_into_db web_func_db database/data/dev/web_functionality_test_data.sql &> /dev/null
docker-compose run web_functionality

echo "WEB USEABILITY"
bash scripts/insert_into_db web_use_db database/data/dev/basic_functions.sql &> /dev/null
bash scripts/insert_into_db web_use_db database/data/dev/web_usability_test_data.sql &> /dev/null
docker-compose run web_usability
